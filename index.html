<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Est√∫dio 23 ‚Äî App</title>
  <link rel="stylesheet" href="css/style.css" />
  <link rel="icon" href="assets/logo.png" />
  <meta name="theme-color" content="#ff7f00" />
</head>
<body>

  <!-- SPLASH: full-screen logo elegante -->
  <div id="splash" class="splash">
    <div class="splash-content">
      <div class="splash-titulo">Est√∫dio 23</div>
      <div class="splash-frase">Excel√™ncia em cada detalhe automotivo</div>
      <div class="splash-bar"><div class="splash-bar-inner"></div></div>
    </div>
  </div>

  <!-- Signup overlay -->
  <div id="signup" class="screen hidden">
    <div class="signup-card">
      <h2>Bem-vindo ao Est√∫dio 23</h2>
      <p>Para come√ßar, informe seus dados de acesso:</p>
      <div class="grid s2">
        <input id="name" placeholder="Nome completo" type="text" autocomplete="name" />
        <input id="phone" placeholder="WhatsApp (somente n√∫meros)" type="tel" autocomplete="tel" />
      </div>
      <button class="btn primary" id="btnSaveSignup">Entrar no Sistema</button>
    </div>
  </div>

  <!-- Topbar (limpa) -->
  <header class="topbar">
    <div class="logo-chip"><img src="assets/logo.png" alt="E23"></div>
    <div class="brand">
      <div class="brand-title">Est√∫dio 23</div>
      <div id="clientChip" class="client-chip">Cliente an√¥nimo</div>
    </div>
    <button class="btn ghost" id="btnShare">Compartilhar</button>
    <button class="btn admin-btn hidden" id="btnAdmin" onclick="openAdminPanel()">ADM</button>
    <button class="btn logout-btn" id="btnLogout" onclick="logout()">Sair</button>
  </header>

  <!-- Bot√µes de Navega√ß√£o -->
  <div class="nav-buttons">
    <button class="nav-btn" onclick="scrollToSection('sec-services')">
      Servi√ßos
    </button>
    <button class="nav-btn" onclick="scrollToSection('sec-subscription')">
      Assinatura
    </button>
    <button class="nav-btn" onclick="scrollToSection('sec-points')">
      Pontos
    </button>
    <button class="nav-btn" onclick="scrollToSection('sec-agenda')">
      Agendar
    </button>
    <button class="nav-btn cart-nav-btn" onclick="scrollToSection('sec-cart')">
      üõí Carrinho
    </button>
  </div>

  <!-- Status da Assinatura -->
  <div class="subscription-status-top" id="subscriptionStatusTop">
    <div class="subscription-container">
      <div class="subscription-icon">
        <span id="subscriptionIconTop">‚≠ê</span>
      </div>
      <div class="status-info">
        <div class="status-header">
          <h4>Status da Assinatura</h4>
          <span class="status-action" id="statusActionTop" onclick="scrollToSection('sec-subscription')">Ver Planos</span>
        </div>
        <div class="status-details">
          <span class="status-badge" id="statusBadgeTop">Sem assinatura</span>
          <div class="status-text" id="statusTextTop">Voc√™ ainda n√£o possui uma assinatura ativa</div>
        </div>
      </div>
    </div>
  </div>

  <!-- Conte√∫do principal -->
  <main class="wrap" id="app" aria-live="polite">
    <section id="sec-points" class="card">
      <h3>Meus pontos</h3>
      <div class="row">
        <div class="kpi"><span id="pointsKpi">0</span> <small>pts</small></div>
        <div class="pill">Meta indicada: 20.000 pts</div>
      </div>
      <div class="divider"></div>
      <div class="row">
        <button class="btn" onclick="scrollToSection('sec-redeem')">Trocar meus pontos</button>
        <button class="btn" onclick="scrollToSection('sec-history')">Ver hist√≥rico</button>
      </div>
    </section>

    <section id="sec-services" class="card">
      <h3>Servi√ßos</h3>
      <div id="servicesList" class="services-grid"></div>
    </section>

    <section id="sec-agenda" class="card">
      <h3>Agendar</h3>
      <button class="btn primary" id="btnOpenAgendaModal">Escolher dia e hor√°rio</button>
      <div id="agendamentoEscolhido" style="margin-top:12px;text-align:center;color:#ff7f00;font-weight:500;"></div>
    </section>

    <section id="sec-cart" class="card cart-section">
      <div class="cart-header">
        <h3>üõí Meu Carrinho</h3>
        <button class="btn-clear-cart hidden" id="btnClearCart">Limpar</button>
      </div>
      
      <div id="cartList" class="cart-list"></div>
      
      <div class="cart-total-simple">
        <span class="total-label">Total a Pagar</span>
        <span class="total-value">R$ <span id="cartTotal">0,00</span></span>
      </div>
    </section>

    <section id="sec-pay" class="card">
      <h3>Pagamento</h3>
      <div id="pixAreaCustom"></div>
    </section>

    <section id="sec-redeem" class="card">
      <h3>Trocar pontos</h3>
      <div id="rewardsList"></div>
    </section>

    <section id="sec-history" class="card">
      <h3>Hist√≥rico</h3>
      <div id="historyList"></div>
    </section>

    <section id="sec-profile" class="card">
      <h3>Meus dados</h3>
      <div class="grid s2">
        <input id="clientName" placeholder="Seu nome" />
        <input id="clientPhone" placeholder="WhatsApp (somente n√∫meros)" />
      </div>
      <div class="row" style="margin-top:8px">
        <button class="btn" id="btnSaveClient">Salvar</button>
      </div>
      <div class="divider"></div>
      <div class="grid s2">
        <input id="personalLink" readonly />
        <button class="btn ghost" id="btnCopyLink">Copiar link</button>
      </div>
    </section>

    <!-- Se√ß√£o de Assinatura (movida para o final) -->
    <section id="sec-subscription" class="card">
      <div class="subscription-header">
        <h3>Programa de Assinatura Mensal</h3>
        <div class="novidade-badge">NOVO</div>
      </div>
      
      <div class="subscription-info">
        <div class="subscription-benefits">
          <h4>Benef√≠cios da Assinatura</h4>
          <ul>
            <li><strong>Plano Mensal:</strong> 2 lavagens simples + 15% OFF em todos os servi√ßos</li>
            <li><strong>Plano Mensal Plus:</strong> 4 lavagens simples + 20% OFF em todos os servi√ßos</li>
            <li><strong>Pontos b√¥nus</strong> mensais</li>
            <li><strong>Agendamento priorit√°rio</strong></li>
          </ul>
        </div>
        
        <div class="subscription-plans">
          <div class="plan-card">
            <div class="plan-header">
              <h4>Plano Mensal</h4>
              <div class="plan-price">R$ 119,99<span>/m√™s</span></div>
            </div>
            <div class="plan-features">
              <div class="feature">‚úì 2 Lavagens Simples</div>
              <div class="feature">‚úì 15% OFF em todos os servi√ßos</div>
              <div class="feature">‚úì 800 pontos b√¥nus mensais</div>
              <div class="feature">‚úì Agendamento priorit√°rio</div>
            </div>
            <button class="btn primary" onclick="subscribeToPlan('monthly')">
              Assinar Plano Mensal
            </button>
          </div>
          
          <div class="plan-card featured">
            <div class="plan-badge">MAIS POPULAR</div>
            <div class="plan-header">
              <h4>Plano Mensal Plus</h4>
              <div class="plan-price">R$ 224,99<span>/m√™s</span></div>
              <div class="plan-savings">4x Lavagens + 20% OFF</div>
            </div>
            <div class="plan-features">
              <div class="feature">‚úì 4 Lavagens Simples</div>
              <div class="feature">‚úì 20% OFF em todos os servi√ßos</div>
              <div class="feature">‚úì 1500 pontos b√¥nus mensais</div>
              <div class="feature">‚úì Agendamento priorit√°rio</div>
            </div>
            <button class="btn primary" onclick="subscribeToPlan('monthlyPlus')">
              Assinar Plano Plus
            </button>
          </div>
        </div>
      </div>
    </section>
  </main>

  <!-- Voltar ao topo -->


  <!-- Toast simples -->
  <div id="toast" class="toast"></div>

  <!-- Modal de Agendamento -->
  <div id="agendaModal" class="screen hidden">
    <div class="agenda-modal-content">
      <button class="agenda-modal-close" onclick="closeAgendaModal()">‚úï</button>
      
      <div class="agenda-container">
        <!-- Modal da Data -->
        <div class="agenda-date-modal">
          <div class="modal-header">
            <h3>üìÖ Selecionar Data</h3>
            <p>Escolha uma data dispon√≠vel para agendamento</p>
          </div>
          <div class="agenda-calendar" id="agendaCalendar"></div>
        </div>
        
        <!-- Modal do Hor√°rio -->
        <div class="agenda-time-modal">
          <div class="modal-header">
            <h3>üïê Selecionar Hor√°rio</h3>
            <p>Escolha um hor√°rio dispon√≠vel para a data selecionada</p>
          </div>
          <div class="agenda-horarios" id="agendaHorarios">
            <div class="no-date-selected">
              <p>Selecione uma data primeiro para ver os hor√°rios dispon√≠veis</p>
            </div>
          </div>
        </div>
      </div>
      
      <div class="agenda-actions">
        <button class="btn primary" id="btnConfirmAgenda" disabled>Confirmar Agendamento</button>
      </div>
    </div>
  </div>

  <!-- Modal do Painel Administrativo -->
  <div id="adminModal" class="screen hidden">
    <div class="admin-modal-content">
      <div class="admin-header">
        <h2>üîê Painel Administrativo</h2>
        <button class="admin-close" onclick="closeAdminPanel()">‚úï</button>
      </div>
      
      <div class="admin-tabs">
        <button class="admin-tab active" onclick="showAdminTab('dashboard')">Dashboard</button>
        <button class="admin-tab" onclick="showAdminTab('agendamentos')">Agendamentos</button>
        <button class="admin-tab" onclick="showAdminTab('clients')">Clientes</button>
        <button class="admin-tab" onclick="showAdminTab('services')">Servi√ßos</button>
        <button class="admin-tab" onclick="showAdminTab('finance')">Financeiro</button>
      </div>
      
      <!-- Dashboard -->
      <div id="adminDashboard" class="admin-tab-content active">
        <div class="admin-stats-grid">
          <div class="stat-card">
            <div class="stat-icon">üë•</div>
            <div class="stat-value" id="totalClients">0</div>
            <div class="stat-label">Total de Clientes</div>
          </div>
          <div class="stat-card">
            <div class="stat-icon">üí∞</div>
            <div class="stat-value" id="totalRevenue">R$ 0,00</div>
            <div class="stat-label">Receita Total</div>
          </div>
          <div class="stat-card">
            <div class="stat-icon">üöó</div>
            <div class="stat-value" id="totalServices">0</div>
            <div class="stat-label">Servi√ßos Realizados</div>
          </div>
          <div class="stat-card">
            <div class="stat-icon">‚≠ê</div>
            <div class="stat-value" id="activeSubscriptions">0</div>
            <div class="stat-label">Assinaturas Ativas</div>
          </div>
        </div>
        
        <div class="admin-recent">
          <h3>Atividades Recentes</h3>
          <div id="recentActivities" class="recent-list"></div>
        </div>
      </div>
      
      <!-- Agendamentos -->
      <div id="adminAgendamentos" class="admin-tab-content">
        <div class="agendamentos-header">
          <h3>üìÖ Agendamentos Pendentes</h3>
          <div class="agendamentos-filters">
            <select id="statusFilter" onchange="filterAgendamentos()">
              <option value="all">Todos os status</option>
              <option value="pending">Pendentes</option>
              <option value="confirmed">Confirmados</option>
              <option value="completed">Conclu√≠dos</option>
            </select>
          </div>
        </div>
        
        <!-- Calend√°rio Visual -->
        <div class="admin-calendar-section">
          <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
            <h4>üìÖ Calend√°rio de Ocupa√ß√£o</h4>
            <button onclick="zerarTodosHorarios()" style="
              background: linear-gradient(135deg, #dc3545, #c82333);
              color: white;
              border: none;
              padding: 8px 16px;
              border-radius: 8px;
              font-size: 0.9rem;
              font-weight: 600;
              cursor: pointer;
              transition: all 0.3s ease;
            ">
              üóëÔ∏è Zerar Todos os Hor√°rios
            </button>
          </div>
          <div id="adminCalendar" class="admin-calendar">
            <!-- Calend√°rio ser√° renderizado aqui -->
          </div>
        </div>
        
        <div class="agendamentos-list" id="agendamentosList">
          <!-- Lista de agendamentos ser√° carregada aqui -->
        </div>
        
        <div class="agendamentos-stats">
          <div class="stat-mini">
            <span class="stat-number" id="pendingCount">0</span>
            <span class="stat-label">Pendentes</span>
          </div>
          <div class="stat-mini">
            <span class="stat-number" id="confirmedCount">0</span>
            <span class="stat-label">Confirmados</span>
          </div>
          <div class="stat-mini">
            <span class="stat-number" id="completedCount">0</span>
            <span class="stat-label">Conclu√≠dos</span>
          </div>
        </div>
      </div>
      
      <!-- Clientes -->
      <div id="adminClients" class="admin-tab-content">
        <div class="admin-search">
          <input type="text" id="clientSearch" placeholder="Buscar cliente..." onkeyup="searchClients()">
        </div>
        <div class="clients-table" id="clientsTable"></div>
      </div>
      
      <!-- Servi√ßos -->
      <div id="adminServices" class="admin-tab-content">
        <div class="services-stats">
          <h3>Estat√≠sticas por Servi√ßo</h3>
          <div id="servicesStats" class="services-grid"></div>
        </div>
      </div>
      
      <!-- Financeiro -->
      <div id="adminFinance" class="admin-tab-content">
        <div class="finance-overview">
          <h3>Vis√£o Geral Financeira</h3>
          <div class="finance-cards">
            <div class="finance-card">
              <h4>Receita Mensal</h4>
              <div class="finance-value" id="monthlyRevenue">R$ 0,00</div>
            </div>
            <div class="finance-card">
              <h4>Receita Anual</h4>
              <div class="finance-value" id="yearlyRevenue">R$ 0,00</div>
            </div>
            <div class="finance-card">
              <h4>M√©dia por Cliente</h4>
              <div class="finance-value" id="avgPerClient">R$ 0,00</div>
            </div>
          </div>
        </div>
        
        <div class="finance-chart">
          <h3>Receita por Per√≠odo</h3>
          <div id="revenueChart" class="chart-container"></div>
        </div>
      </div>
    </div>
  </div>

  <!-- Bot√£o Flutuante do Carrinho -->
  <div id="floatingCartBtn" class="floating-cart-btn" onclick="scrollToCart()">
    <div class="cart-icon">üõí</div>
    <div class="cart-count" id="floatingCartCount">0</div>
  </div>

  <!-- Firebase SDK -->
  <script type="module">
    // Import the functions you need from the SDKs you need
    import { initializeApp } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-app.js";
    import { getFirestore, collection, doc, setDoc, getDoc, getDocs, addDoc, updateDoc, deleteDoc, query, where, orderBy, onSnapshot } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-firestore.js";
    import { getAuth, signInAnonymously, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-auth.js";

    // Your web app's Firebase configuration
    const firebaseConfig = {
      apiKey: "AIzaSyDlEKzNoOmyXATY56PTymuSH6W_0rI12mA",
      authDomain: "estudio23-193cd.firebaseapp.com",
      projectId: "estudio23-193cd",
      storageBucket: "estudio23-193cd.firebasestorage.app",
      messagingSenderId: "1048310058777",
      appId: "1:1048310058777:web:03557a841b35b90a7c3f88"
    };

    // Initialize Firebase
    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    const auth = getAuth(app);
    
    // Make Firebase services available globally
    window.firebaseApp = app;
    window.firebaseDB = db;
    window.firebaseAuth = auth;
    window.firebaseServices = {
      collection,
      doc,
      setDoc,
      getDoc,
      getDocs,
      addDoc,
      updateDoc,
      deleteDoc,
      query,
      where,
      orderBy,
      onSnapshot
    };
  </script>
  
  <script src="js/app.js" defer></script>
</body>
</html>
